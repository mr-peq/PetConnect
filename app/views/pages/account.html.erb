<div class="container mt-4">
<!-- User Card -->
<div class="mb-4 d-flex align-items-center">
  <!-- Profile Image -->
  <div class="profile-picture mr-4" style="margin-right: 30px">
    <% if current_user.profile_picture.attached? %>
      <%= cl_image_tag(current_user.profile_picture.key, class: 'user-avatar', height: 150, style: 'border-radius: 50%;') %>
    <% else %>
      <!-- Default avatar image if no profile picture -->
      <img src="https://images.unsplash.com/photo-1529946825183-536c6317f60e?q=80&w=3163&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Default Avatar" class="user-avatar" style="height: 150px; border-radius: 50%;" />
    <% end %>
  </div>

  <div class="card flex-grow-1">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <!-- User Info Section -->
        <div>
          <h2 class="user-name mb-2"><%= @user.first_name %> <%= @user.last_name %></h2>
          <p class="user-info mb-2"><%= @user.address %></p>
          <% if @user.pet %>
            <p>Owner of a <%= @user.pet.pet_category.pet_category %></p>
          <% else %>
            <p>Not yet a pet owner</p>
          <% end %>
          <% if @user.about.present? %>
            <p class="about-section"><%= @user.about %></p>
          <% else %>
            <p class="about-section placeholder-text text-secondary">
              Tell us about yourself, your pet and let people see how amazing you are!
            </p>
          <% end %>
        </div>

        <!-- Ratings Section -->
        <div class="ratings text-right">
          <% average_rating = @user.average_rating %>
          <% if average_rating.positive? %>
            <% 5.times do |i| %>
              <i class="fas fa-star <%= 'text-warning' if i < average_rating %>"></i>
            <% end %>
            <span>(<%= average_rating.round(1) %>)</span>
          <% else %>
            <span class="text-secondary">No reviews yet</span>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="container">
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" id="accountTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active user-info mb-2" id="my-pet-tab" data-bs-toggle="tab" data-bs-target="#my-pet" type="button" role="tab" aria-controls="my-pet" aria-selected="true">My Pet</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link user-info mb-2" id="my-services-tab" data-bs-toggle="tab" data-bs-target="#my-services" type="button" role="tab" aria-controls="my-services" aria-selected="false">My Services</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link user-info mb-2" id="my-bookings-tab" data-bs-toggle="tab" data-bs-target="#my-bookings" type="button" role="tab" aria-controls="my-bookings" aria-selected="false">My Bookings</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link user-info mb-2" id="my-reviews-tab" data-bs-toggle="tab" data-bs-target="#my-reviews" type="button" role="tab" aria-controls="my-reviews" aria-selected="false">My Reviews</button>
    </li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content" id="accountTabsContent">
    <div class="tab-pane fade show active" id="my-pet" role="tabpanel" aria-labelledby="my-pet-tab">
      <!-- My Pet information goes here -->
      <% if @user.pet %>
      <div class="card pet-card mt-4 mb-4">
        <div class="row no-gutters align-items-center">
          <div class="col-md-8">
            <div class="pet-card-body">
              <h5 class="card-title"><%= @user.pet.name %></h5>
              <p class="card-text"><%= @user.pet.pet_category.pet_category %></p>
            </div>
          </div>
          <div class="col-md-4">
            <% if @user.pet.pet_picture.attached? %>
              <%= cl_image_tag(@user.pet.pet_picture.key, class: 'pet-image') %>
            <% else %>
              <img src="https://images.unsplash.com/photo-1574870111867-089730e5a72b?q=80&w=2987&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90oy1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Default Pet Image" class="pet-image" />
            <% end %>
          </div>
        </div>
      </div>
    <% else %>
      <!-- Display the button to add a pet if no pet is present -->
      <div class="add-pet mt-4" data-controller="modal">
        <!-- Trigger/Open The Modal -->
        <button data-action="click->modal#open" class="btn btn-primary">Add my pet</button>
        <!-- Modal for adding pet -->
        <div data-action="click@window->modal#clickOutside">
          <!-- Modal content -->
          <div class="modal" data-modal-target="modal">
            <div class="modal-content">
              <span data-action="click->modal#close" class="close">&times;</span>
              <h3>Add a New Pet</h3>
              <%= simple_form_for(@pet, html: { class: 'form-modal' }) do |f| %>
                <%= f.error_notification %>
                <%= f.input :name, input_html: { class: 'form-control' } %>
                <%= f.input :pet_category_id, collection: PetCategory.all.pluck(:pet_category, :id), input_html: { class: 'form-select' } %>
                <%= f.input :pet_picture, as: :file, input_html: { class: 'form-control' } %>
                <%= f.submit "Add Pet", class: "btn btn-success" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
    </div>

  <div class="tab-pane fade" id="my-services" role="tabpanel" aria-labelledby="my-services-tab">
    <!-- My Services information goes here -->
    <div id="my-services">
      <div class="row mt-4">
        <!-- Trigger/Open The Modal -->
        <button class="btn btn-primary mb-4">Add a service</button>
        <% @user.services.each do |service| %>
          <div class="col-md-4 mb-3">
            <div class="service-card">
              <div class="service-image" style="background-image: url('<%= url_for(service.service_picture) %>');">
                <div class="service-icons">
                  <%= link_to edit_service_path(service), class: 'edit-icon' do %>
                    <i class="fa-regular fa-pen-to-square"></i>
                  <% end %>
                  <%= link_to service_path(service), method: :delete, data: { confirm: 'Are you sure?' }, class: 'delete-icon' do %>
                    <i class="fa-regular fa-circle-xmark"></i>
                  <% end %>
                </div>
              </div>
              <div class="service-details">
                <h5 class="service-title"><%= service.title %></h5>
                <p class="service-categories">
                  <%= service.pet_categories.pluck(:pet_category).join(', ') %>
                </p>
                <p class="service-description"><%= service.description %></p>
                <p class="service-price"><%= number_to_currency(service.price) %>â‚¬</p>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>


    <div class="tab-pane fade" id="my-bookings" role="tabpanel" aria-labelledby="my-bookings-tab">
      <!-- My Bookings information goes here -->
      <div id="my-bookings">
      <div class="row">
        <% @bookings.each do |booking| %>
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title"><%= booking.service.title %></h5>
                <p class="card-text"><strong>Start Time:</strong> <%= booking.start_time.strftime("%B %d, %Y %H:%M") %></p>
                <p class="card-text"><strong>Address:</strong> <%= booking.service.address %></p>
                <%= link_to 'View Booking', booking_path(booking), class: 'btn btn-primary' %>
                <%= link_to 'Delete', booking_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: 'btn btn-danger' %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    </div>

    <div class="tab-pane fade" id="my-reviews" role="tabpanel" aria-labelledby="my-reviews-tab">
      <!-- My Reviews information goes here -->
      <div id="my-reviews">
      <div class="row">
        <% @user.reviews.each do |booking| %>
          <div class="col-md-4 mb-3">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title"><%= booking.service.title %></h5>
                <p class="card-text"><strong>Start Time:</strong> <%= booking.start_time.strftime("%B %d, %Y %H:%M") %></p>
                <p class="card-text"><strong>Address:</strong> <%= booking.service.address %></p>
                <%= link_to 'View Booking', booking_path(booking), class: 'btn btn-primary' %>
                <%= link_to 'Delete', booking_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: 'btn btn-danger' %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    </div>
  </div>
</div>
</div>
