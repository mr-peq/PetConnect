<div class="container mt-4">
  <!-- Pet Care Provider Card -->

  <div class="row mb-4">
    <div class="col-12">
        <div class="row no-gutters">
          <!-- Profile Image -->
          <div class="col-md-4 d-flex float-left">
            <!-- <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=3087&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Profile Image" class="rounded-circle" style="width: 150px; height: 150px;"> -->
            <% if current_user.profile_picture.attached? %>
                <%= cl_image_tag(current_user.profile_picture.key, class: "avatar-big") %>
              <% else %>
                <!-- Default avatar image if no profile picture -->
                <img src="https://images.unsplash.com/photo-1529946825183-536c6317f60e?q=80&w=3163&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="avatar-big" />
              <% end %>
          </div>
          <!-- Provider Info -->
          <div class="col-md-8">
            <div class="card-body" style="border-radius: 15px">
              <h2 class="mb-0"><%= @service.user.first_name %> <%= @service.user.last_name.chars.first %>.</h2>
              <p class="text-secondary"><%= @service.address %></p>
          <!-- Ratings with FontAwesome Stars -->
          <p>
            <% average_rating = @service.user.average_rating %>
            <% 5.times do |i| %>
              <i class="fas fa-star <%= 'text-warning' if i < average_rating %>"></i>
            <% end %>
            <span>(<%= average_rating.round(1) %>)</span>
          </p>
          <!-- Contact Button -->
          <a href="#" class="btn btn-primary">Contact <%= @service.user.first_name %></a>
            </div>
          </div>
        </div>
    </div>
  </div>

  <br>
  <br>
  <div class="d-flex">
  <!-- sticky Section -->

    <div class="card shadow flex-fill w-75 h-75 sticky-top" style="border-radius: 15px">
        <div class="card-body">
          <h5 class="card-title">Book <%= @service.user.first_name %> - Service: <%= @service.title %></h5>
          <%= simple_form_for([@service, @service.bookings.new], wrapper: :vertical_form, html: { class: 'form-horizontal' }) do |f| %>
            <div class="form-row">
              <div class="form-group col-md-8">
                <%= f.input :date, as: :string, label: 'Choose a date', input_html: { data: { controller: "datepicker" } }, wrapper_html: { class: 'mb-3' }, minute_step: 30 %>
                <%= f.input :start_time, as: :time, label: 'Choose a time', input_html: { class: 'form-control' }, wrapper_html: { class: 'mb-3' }, minute_step: 30 %>
              </div>
            </div>
            <p style="font-weight: bold; font-size: 17px"> Price: <%= @service.price %> € </p>
            <%= f.button :submit, "Book Now", class: "btn btn-primary btn-lg btn-block" %>
          <% end %>
        </div>
    </div>


  <!-- Not Sticky Section -->
    <div class="d-flex flex-column" style="margin-left: 40px">
      <!-- <About the...> Section -->
      <div class="d-flex mb-3">
        <div class="card shadow flex-fill" style="border-radius: 15px;">
          <div class="card-body">
            <h5 class="card-title">About the <%= @service.title %> service</h5>
            <p class="card-text"><%= @service.description %></p>
          </div>
        </div>
      </div>

      <!-- Map Section -->
      <div class="d-flex mb-3">
        <div class="card shadow w-100" style="height: 400px; border-radius: 15px;">
          <img src="https://pbs.twimg.com/media/EW2R5lAX0AUmRUj.jpg" alt="Map of Paris" style="height: 100%; width: 100%; object-fit: cover; border-radius: 15px;">
        </div>      <!-- Include map initialization script here -->
      </div>

      <!-- Reviews Section-->
      <div class="card shadow mb-3" style="height: 150px; border-radius: 15px;">
        <div class="card-body">
          <h5 class="card-title">Reviews for <%= @service.title %></h5>
            <br>
            <% reviews = @service.bookings.includes(:review).map(&:review).compact %>
            <% if reviews.any? %>
            <% reviews.each_with_index do |review, index| %>
                <div class="rating">
                  <% review.rating.times do %>
                    <i class="fas fa-star text-warning"></i>
                  <% end %>
                  <% (5 - review.rating).times do %>
                    <i class="fas fa-star"></i>
                  <% end %>
                </div>
              <div class="review">
                <p><%= review.description %></p>
                <% if index < reviews.length - 1 %>
                  <hr>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <p>No reviews yet for this service.</p>
          <% end %>
        </div>
      </div>

    <!-- About Section -->
      <div class="d-flex mb-3">
        <div class="card shadow w-100">
          <div class="card-body">
            <h5 class="card-title">About <%= @service.user.first_name %></h5>
            <p class="card-text"><%= @service.description %></p>
          </div>
        </div>
      </div>

    <!-- Other Services Section -->
      <div class="d-flex mb-3">
        <div class="card shadow w-100">
          <div class="card-body">
            <h5 class="card-title">Other services - by <%= @service.user.first_name %></h5>
            <ul class="list-group list-group-flush">
              <% @service.user.services.each do |other_service| %>
                <li class="list-group-item">
                  <div class="d-flex justify-content-between">
                  <%= link_to other_service.title, service_path(other_service), class: "d-flex justify-content-between" %>
                  <span><%= number_to_currency(other_service.price.round, unit: '€') %></span>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
